{% extends 'calculadoras/base.html' %}

{% block calculadora_content %}
<div class="card">
    <div class="card-header">
        <h4>Calculadora de Divisas</h4>
    </div>
    <div class="card-body">
        <form method="post" action="{% url 'calculadoras:calculadora_divisas' %}">
            {% csrf_token %}
            <div class="row mb-3">
                <div class="col-md-5">
                    <label for="monto" class="form-label">Monto</label>
                    <input type="number" step="0.01" min="0" class="form-control" id="monto" name="monto" 
                           value="{{ resultado.monto_original|default:'1' }}" required>
                </div>
                <div class="col-md-3">
                    <label for="moneda_origen" class="form-label">De</label>
                    <select class="form-select" id="moneda_origen" name="moneda_origen" required>
                        {% for moneda in monedas %}
                            <option value="{{ moneda }}" 
                                    {% if resultado and resultado.moneda_origen == moneda %}selected{% endif %}>
                                {{ moneda }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-1 d-flex align-items-center justify-content-center">
                    <button type="button" id="swapBtn" class="btn btn-outline-secondary mt-4">
                        <i class="bi bi-arrow-left-right"></i>
                    </button>
                </div>
                <div class="col-md-3">
                    <label for="moneda_destino" class="form-label">A</label>
                    <select class="form-select" id="moneda_destino" name="moneda_destino" required>
                        {% for moneda in monedas %}
                            <option value="{{ moneda }}" 
                                    {% if resultado and resultado.moneda_destino == moneda %}selected{% endif %}
                                    {% if not resultado and moneda == 'EUR' %}selected{% endif %}>
                                {{ moneda }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Convertir</button>
        </form>

        {% if resultado %}
        <div class="mt-4 p-3 bg-light rounded">
            <h5>Resultado:</h5>
            <p class="h3">
                {{ resultado.monto_original|floatformat:2 }} {{ resultado.moneda_origen }} = 
                <strong>{{ resultado.monto_convertido|floatformat:2 }} {{ resultado.moneda_destino }}</strong>
            </p>
            <p class="text-muted mt-2">
                Tasa de cambio: 1 {{ resultado.moneda_origen }} = 
                {{ resultado.monto_convertido|floatformat:6|default:'1.000000' }} {{ resultado.moneda_destino }}
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Intercambiar monedas
        document.getElementById('swapBtn').addEventListener('click', function() {
            const monedaOrigen = document.getElementById('moneda_origen');
            const monedaDestino = document.getElementById('moneda_destino');
            const temp = monedaOrigen.value;
            monedaOrigen.value = monedaDestino.value;
            monedaDestino.value = temp;
        });
    });
</script>
{% endblock %}
